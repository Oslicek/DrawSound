<Project>
  <PropertyGroup>
    <GeneratedCommitInfo>$(MSBuildThisFileDirectory)GeneratedCommitInfo.cs</GeneratedCommitInfo>
  </PropertyGroup>

  <Target Name="GenerateCommitInfo" BeforeTargets="Compile">
    <Exec Command="git rev-parse --short HEAD &gt; $(IntermediateOutputPath)commit.txt"
          IgnoreExitCode="true" />
    <ReadLinesFromFile File="$(IntermediateOutputPath)commit.txt">
      <Output TaskParameter="Lines" PropertyName="CommitHashRaw" />
    </ReadLinesFromFile>
    <PropertyGroup>
      <CommitHash>$([System.String]::Copy('$(CommitHashRaw)').Trim())</CommitHash>
    </PropertyGroup>
    <WriteLinesToFile File="$(GeneratedCommitInfo)"
                      Lines="namespace DrawSound; public static class BuildInfo { public const string CommitHash = &quot;$(CommitHash)&quot;; }"
                      Overwrite="true" />
    <ItemGroup>
      <Compile Include="$(GeneratedCommitInfo)" />
    </ItemGroup>
  </Target>
</Project>

